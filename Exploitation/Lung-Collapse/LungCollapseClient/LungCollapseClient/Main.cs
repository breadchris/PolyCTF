using System;
using System.IO;
using System.Net;
using System.Text;
using System.Net.Sockets;

namespace LungCollapseClient
{
public class LungCollapse {

		public static void Main() {
			String ipaddress = "127.0.0.1";
			int port = 1337;
			StatusCheckerMessage scm = new StatusCheckerMessage();

			try {
				TcpClient tcpclnt = new TcpClient();
				Console.WriteLine("Welcome to the client for the Closed LLS version 1.0.1 server!");
				Console.WriteLine("\nWe are going to check if the server is still running.");
				
				tcpclnt.Connect(ipaddress, port);
				Stream connection = tcpclnt.GetStream();

				Console.WriteLine("[*] Connected");
				Console.WriteLine("[*] Polling remote server");

				byte[] msg = scm.generateStatusMessage();
				connection.Write(msg, 0, msg.Length);
				
				byte[] responseMsg  = new byte[StatusCheckerMessage.MAX_MESSAGE_BYTES];
				connection.Read(responseMsg, 0, StatusCheckerMessage.MAX_MESSAGE_BYTES);
				Console.Write("[+] Server responded with: ");

				byte[] responseContent = scm.getResponseContent(responseMsg);

				Console.Write(responseContent.Length.ToString() + " bytes");
				
				tcpclnt.Close();
			}
			
			catch (Exception e) {
				Console.WriteLine("[-] Error: " + e.StackTrace);
			}
		}
		
	}
}