#include <stdlib.h>
#include <sys/types.h>
#include <stdio.h>
#include <unistd.h>
#include <signal.h>

#define BUFFERSIZE 1024

void getFlag() {
	char flag[64];
	FILE* f;

	f = fopen("flag", "r");
	if (f == NULL) {
		perror("Could not open your flag :C");
		exit(1);
	}

	if (!fgets(flag, sizeof(flag), f)) {
		perror("Could not read your flag :C");
		exit(1);
	}	

	printf("Here is your flag: %s\n", flag);
}

void signalHandler(int signum) {
	printf("You crashed the program!\n");

	getFlag();

    signal(signum, SIG_DFL);
    kill(getpid(), signum);
}

void badProgramming() {
	char input[64];
	fgets(input, BUFFERSIZE, stdin);
}

int main() {
	signal(SIGSEGV, signalHandler);

	printf("Can you make me crash? :D\n");

	badProgramming();

	printf("Why won't you crash me?!?!?!?!\n");

	return 0;
}
